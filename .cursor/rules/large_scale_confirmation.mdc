---
description: 防止大规模代码删除或修改
globs: ["**/*"]
alwaysApply: true
---

# 大规模修改确认

为保护代码库的完整性和防止意外的大规模修改，所有超过特定阈值的修改操作都必须经过明确确认。

## 适用场景

当满足以下任一条件时，必须特别提醒用户并获得明确许可：

1. 需要删除超过10行代码
2. 修改内容超过文件30%
3. 一次性修改超过3个文件
4. 删除整个文件或目录

## 警告提示

在提出可能导致大规模修改的方案时，使用明确的警告语：

```
⚠️ 注意：此操作将删除大量代码/进行大规模修改，可能影响系统稳定性。您确定要继续吗？
```

## 确认流程

1. **提出警告**：
   - 使用醒目的警告标识(⚠️)
   - 清晰说明修改的范围和影响
   - 提供可能的风险评估

2. **获取明确许可**：
   - 要求用户明确使用"确认"、"同意"等肯定词语
   - 不接受模糊回复作为确认
   - 建议用户在确认前检查影响

3. **提供替代方案**：
   - 在可能的情况下，提供更渐进的修改方案
   - 建议分步实施大规模修改
   - 提醒用户考虑创建备份或分支

## 实施示例

当准备进行大规模修改时，按以下方式提出并等待确认：

```
## 大规模修改提示

我计划对`src/core/database.py`文件进行以下修改：
- 删除当前的数据库连接逻辑(约15行代码)
- 替换为新的ORM实现(约40行代码)

⚠️ 注意：此操作将删除超过10行代码，并修改文件约40%的内容。这可能会影响依赖于当前数据库接口的其他组件。

**替代方案**：可以先添加新实现，保留旧实现作为备用，之后再逐步迁移。

您是否确认继续这一大规模修改？请明确回复"确认"或"拒绝"。
```

只有在收到用户明确的"确认"回复后，才能实施这类大规模修改。 